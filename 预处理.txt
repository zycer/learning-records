在获取OSM文件后系统会根据区域位置请求对应区域的开放交通数据API接口，筛选出对应区域的GPS历史轨迹数据，图 5.6为下载的GPS轨迹数据，数据包含对应道路的id以及若干轨迹点，这些数据作为原始输入，为后续的数据预处理和分析提供基础。

数据预处理：在这一部分，对获取到的GPS轨迹数据和OSM文件进行处理，以便更好地应用于地图匹配和模型训练与预测。数据预处理包括以下几个步骤：
a)	GPS轨迹去噪：对于车辆停止时产生的轨迹数据以及两个连续轨迹点位置相差过大的点进行删除，从而减少噪声对模型训练与预测的影响。
b) OSM文件解析：读取OSM文件中的node标签与way标签，将OSM数据解析成路网图结构，并将解析后的路网图进行简化，即对于同一路口的多个节点合并为同一个节点，图 5.7为处理后的道路数据，其中每一条数据作为路网图结构中的一条边，每一条道路有name、hightway、length以及maxspeed等多个特征，图 5.8为处理后的到路口数据，每一条数据作为路网结构中的一个节点，由于节点只表示道路的连接性，所以节点除了位置信息无其他特征。这一步骤为后续的地图匹配和模型训练与预测提供了基本的地理信息。
c) 图反转：将解析出的路网图进行反转，即将原来的道路表示为边，路口表示为节点的图结构反转为道路表示为节点，道路之间的连接关系表示为边。这样能够更好地适应基于贝叶斯时空图自编码器的模型学习与特征表示。图 5.9为反转后的边数据。



数据预处理
数据预处理分为GPS轨迹去噪、OSM文件解析以及图反转。
1. GPS轨迹去噪
对于车辆停止时产生的轨迹数据以及两个连续轨迹点位置相差过大的点进行删除，然后使用卡尔曼滤波法GPS数据中偏差较大的数据点进行纠正，从而减少噪声对模型训练与预测的影响。
2. OSM文件解析
读取OSM文件中的node标签与way标签，将OSM数据解析成路网图结构，并将解析后的路网图进行简化，即对于同一路口的多个节点合并为同一个节点，道路数据中每一条道路有name、hightway、length以及maxspeed等多个特征，路口数据中，每一条数据作为路网结构中的一个节点，由于节点只表示道路的连接性，所以节点除了位置信息无其他特征。这一步骤为后续的地图匹配和模型训练与预测提供了基本的地理信息。
3. 图反转
将解析出的路网图进行反转，即将原来的道路表示为边，路口表示为节点的图结构反转为道路表示为节点，道路之间的连接关系表示为边。这样能够更好地适应基于贝叶斯时空图自编码器的模型学习与特征表示。



数据预处理

 为了使基于贝叶斯时空图自编码器的道路行驶时间预测模型更准确地学习与预测,我们需要对原始数据进行一系列预处理。本节将对数据预处理的三个步骤进行详细描述:GPS轨迹去噪、OSM文件解析以及图反转。

1. GPS轨迹去噪  

由于GPS信号容易受到建筑物、天气等环境影响,会产生一定量的噪声,影响位置精度。为减少噪声对模型的影响,我们对车辆停止期间记录的轨迹数据以及两个连续GPS点的位置偏差过大的数据点进行删除。对于仍存在较大误差的GPS数据点,我们采用卡尔曼滤波法[1]对其进行校正。

卡尔曼滤波法是一种递归的线性最小二乘问题,通过状态方程和观测方程迭代求解当前时刻的状态估计值。状态方程表达系统动态模型,观测方程表达观测值与状态变量之间的关系。状态方程如下:  

x_k = Ax_{k-1} + Bu_k + w_k  	      (1)  

观测方程如下:

z_k = Hx_k + v_k	                        (2)  

其中,$x_k$ 为状态变量,$u_k$ 为控制变量,$w_k$ 为过程噪声,$z_k$ 为观测变量,$v_k$ 为观测噪声。通过反复求解上述方程,我们可以获得当前时刻更加准确的状态估计值。该方法能有效利用历史信息对当前信息进行校正,从而得到更加精确的结果。

2. OSM文件解析  

我们解析OSM文件[2]中node标签和way标签,将OSM数据解析成路网图结构。OSM文件记录了全球范围内道路与交叉路口数据。然后对解析后的路网图进行简化,将同一路口的多个节点合并为同一个节点。每条道路有name、highway、length和maxspeed等特征,每个路口作为一个节点,节点除位置信息外无其他特征。该步骤为后续的地图匹配和模型训练与预测提供基本地理信息。

3. 图反转  

为更好地适应基于贝叶斯时空图自编码器的学习与表示,我们将路网图进行反转,即将原有的以道路为边、路口为节点的图结构反转为以道路为节点、道路之间连接关系为边的图结构。这样可以使模型更好地学习道路特征并利用道路之间的时空关联进行推理。换言之,反转后的图结构更符合模型的学习机制,有助于模型学习交通网络的时空依赖关系。

参考文献  

[1] Kalman R E. A New Approach to Linear Filtering and Prediction Problems[J]. Journal of Basic Engineering, 1960, 82(1):35-45.  

[2] OpenStreetMap Wiki. Osmosis, 2020. https://wiki.openstreetmap.org/wiki/Osmosis.

