# 摘要
近年来，世界新能源汽车的发展已经进入工业规模，但电动汽车（EV）由于电池的容量，存在续航里程短的缺点，需要在充电站补充电能。虽然电动汽车充电桩的数量与日俱增，但其增长速度并没有赶上电动汽车的充电需求。为了为用户提供用电方便、高效充电的个性化充电服务，提出了一套基于协同过滤算法的电动汽车充电智能推荐模型，根据用户历史行为数据提供最优的充电方法。
# 1. 引言
为了减少城市交通造成的温室气体排放，新能源汽车，主要是电动汽车（EV），已经成为传统汽车产业升级、城市环境治理、能源替代等方面的共同目标。随着电动汽车的日益普及，城市交通的发展需要面对电动汽车用户的行驶距离焦虑、充电排队焦虑等问题，以及大量电动汽车增长带来的电网负荷超载和交通拥堵压力。实现有效的个性化电动汽车充电引导策略，为用户提供良好的充电服务，可以缓解未来几年大量电动汽车充电请求和出行需求给电网和交通带来的压力，满足当前电动汽车发展的需要。

近年来，随着互联网技术的快速发展，推荐技术得到了广泛的应用。有效的推荐技术可以为用户提供定制化的服务，不仅有利于用户快速获取感兴趣的物品和信息，而且可以增加系统的活跃用户数量。本文的研究内容是基于用户的历史充电行为，结合电动汽车的特点，利用推荐技术为用户带来更便捷、合理的充电体验。
# 2. 系统模型
随着电网规模的扩大，以主站为数据处理核心的传统电网架构越来越难以应对海量终端设备的接入。目前，数据计算和分析是电网系统的短板。电力调度网络作为智能电网的一部分，为了弥补电网终端数据处理能力薄弱的问题，在充电站和充电桩中部署边缘物联网代理设备，统一接入站内设备，获取实时信息。

基于边缘计算，实现了区域自治和局部计算。数据将通过有线或无线网络传输到云管理平台，实现充电站耗电预测、故障分析、用户充电方案推荐等服务。本文的计费调度网络场景架构如图1所示。

------------- 图1 --------------------

在架构图中，汽车是充电请求的发起者，将EV的终端状态信息上传到手机上；云主要由大型云服务器集群组成，具有高效的计算能力和巨大的存储资源。是整个充电调度网络的管理中心和数据分发中心；充电桩终端和边缘计算系统负责收集和计算充电终端的功率数据，并分析算法结果，指导推荐策略。

基于电网边缘计算的功能需求，充电调度网络边缘计算架构将相对轻量级的云业务部分转移到终端附近的边缘侧，降低数据传输时延，节省带宽资源，保证边缘侧业务的及时性。同时，边缘设备可以对终端采集的数据进行预处理，削弱或消除无效数据和错误数据对后续计算的干扰，大大缓解云服务器的数据处理压力。

本文基于“边-云-车”架构的充电调度步骤如下：
- 首先，用户发起充电方案推荐请求，用户通过EV自身的通信模块或手动输入，将EV的实时参数，包括地理位置、剩余电量、充电类型等信息发送到云管理平台。
- 云管理平台会将备份的EV信息和充电要求发送给边缘设备。
- 同时，在边缘侧，边缘设备根据实时采集的每个充电终端的状态信息确定每个充电站的运行状态，利用智能推荐算法向用户推荐合适的充电桩，并将计算结果返回给云管理平台。
- 云管理平台将生成最优充电方案推荐表，并推送到充电用户客户端。

# 3. 电动汽车的充电特性
通过对用户充电行为的分析，结合充电桩运营平台采集的数据，本文总结出电动汽车充电模式的特点如下：
- 充电桩数量不足：电动汽车数量远大于充电桩数量，电动汽车数量增长快于充电桩的增长。
- 最新数据显示，充满电的电动汽车的具体里程与电池的性能、容量、环境、温度、路况等直接相关。此外，当电池低于30%时，必须尽快充电。因此，电动汽车的充电数据不断更新，用户在选择充电桩时，会关注符合自己喜好的充电桩，因此，在充电智能推荐模型中，新的数据要及时处理，有效提高推荐质量。
- 用户充电行为的区域：与网购、电影、音乐不同，用户对充电桩的选择具有很强的区域特征。在某一区域生活或工作的用户很可能会选择该区域的充电桩进行充电，不同区域的用户对不同区域充电桩的偏好差异很大。
- 用户充电行为相关性：用户的充电行为容易受到相邻用户的影响。相邻用户是指与目标用户具有相同偏好度的用户。由于其充电习惯，目标用户和周边用户大概率选择具有相同特性的充电桩。因此，在设计电动汽车充电智能推荐模型时，可以考虑用户的邻居提供个性化的推荐服务。

# 4. 协同过滤推荐模型
## 4.1 距离计算模型
为了为用户提供合理的充电推荐服务，距离因子是重要的参考指标之一。本文采用**哈弗辛公**式计算了两个经纬度之间的距离。哈弗辛公式是实现地理空间距离分布的三角函数。在球面三角形中，哈弗辛函数用于表示两侧与其相对边的角度或两个角度与其相对角之间的夹边之间的关系：
$$ Havsine(\theta)=sin^2(\frac{\theta}{2}=(1-cos(\theta))) / 2 \eqno(1) $$ 
用户位置和充电站位置之间的纬度定义为$\varphi_1$和$\varphi_2$，经度为$\omega_1$和$\omega_2$。将经纬度替换为哈弗辛公式：
$$ Hav(\Theta)=Hav(\varphi_2-\varphi_1)+cos(\varphi_1)cos(\varphi_2)Hav(\omega_2-\omega_1) \eqno(2) $$
则两地之间的大致直线距离为：
$$ d=R \Theta eqno(3) $$
其中，R为地球半径。
## 4.2 协同过滤
基于内容的推荐技术是分析项目内容信息的特征，计算与用户推荐项目兴趣的匹配度[3]。鉴于用户的充电行为容易受到邻居的影响，具有区域特征，在推荐算法策略的选择中考虑了协同过滤推荐算法，即根据用户的历史行为数据，分析用户或充电站之间的相似性。计算用户对充电站的偏好值，并根据最佳值提出建议。

协同过滤推荐算法分为两类：**基于内容的协同过滤**和**基于用户的协同过滤**。基于内容的协同过滤根据用户的历史得分计算充电站之间的相似性，更注重个性化。基于用户的协同过滤是根据用户的历史行为计算用户的相关性，更加关注社交化。本文选择了基于内容的协同过滤算法，由于用户数量大于充电桩数量，用户偏好相对固定，充电桩增速相对缓慢。此外，提供推荐理由更方便，增加用户对系统的信任度。

根据用户实时上传的电动汽车地理位置、剩余电量、充电类型等数据，以剩余电量为约束条件，计算出附近充电站集。然后，可以根据同一区域内其他用户对充电站的评级，预测用户对该区域未使用充电站的偏好。

例如，下表I是用户U1~U6对充电站C1~C7的评级得分，'-'表示用户没有对充电站进行评级。

|   | U1  | U2  | U3  | U4  | U5  | U6  |  | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: | :------------: |  | C1  | 5  |  4 |  4 | -  | 4 | - |  |  C2 | -  | 3  | 5  | 3  | - | - |  | C3  | 4  | -  | -  | -  | 5 | - |  | C4  | 4  | -  | 4  | 4  | 5 | - |  | C5  | 3  | -  | 3  | 3  | - | - |  | C6  | 4  | -  | 2  | 3  | - | - |  | C7  | 5  | 5  | -  | -  | 4 | - |  
