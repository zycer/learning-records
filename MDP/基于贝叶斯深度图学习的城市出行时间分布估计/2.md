## 4.2 行程时间分布估算
我们首先研究了估计的旅行时间分布与地面真值分布之间的偏差，这是评估TTDE方法的最重要指标之一。特别是，以下方法作为本实证研究的基线：
- **历史断言**，链路旅行时间分布随时间推移是静态的。前一天（Hist-1D）或上周（Hist-1W）相同时间段的分布用作当前旅行时间分布。
- **高斯**【12】和**对数正态分布**【13】假设旅行时间遵循高斯分布或对数正态分布。这两种方法使用历史数据拟合各自的概率模型。
- **潜在分段**、**基于危险的(LSH) **[10]方法利用路况影响因素构建TTDE基于危险的模型。由于GPS记录中缺乏气象数据，我们只使用交通速度来建立基于危险的模型。
- **改进的高斯混合模型(MGM)**[26]通过考虑信号交叉口延迟，采用了TTDE的高斯混合模型。
- **稀疏网络的贝叶斯推理(BISN)** [4]结合了TTDE的高斯耦合和贝叶斯推理。这种方法是最先进的。

我们注意到最近的一项工作【8】，它利用核密度估计器（KDE）来估计旅行时间分布。由于本工作的重点是使用稀疏部署的静态流量检测器的数据进行TTDE，我们不将该方法作为基线。根据结果，KDE得出的结果与MGMM相当，发散改善约0.05 KL【8，表VI】。因此，与MGMM进行比较，可以为其相对于拟议的DeepTTDE的相对性能提供定性参考。

表1显示了DeepTTDE和上述基线方法在KDD CUP 2020数据集上的性能比较。在表中，我们总结了所有测试时间段内所有链路的KL发散和海林格距离的平均值和标准偏差。此外，我们进一步展示了比较方法在拥堵时间段（上午7:30–上午9:30和下午5–晚上7点）和剩余自由流时间段上的性能。从比较中，我们可以观察到，拟议的DeepTTDE在所有时间段内的表现始终优于所有基线。平均而言，DeepTTDE在所有时间段都达到了令人满意的平均KL发散，为0.86，而表现最好的基线得分为0.95。大约10%的减少可以归功于在DeepTTDE中设计的独特贝叶斯图卷积算子，该算子有助于模型更好地从旅行时间不确定性中学习。这主张在未来数据驱动的TTDE相关研究中采用贝叶斯和几何深度学习原理。进一步，DeepTTDE能够在拥塞和自由流时间段生成精确的旅行时间分布，性能偏差可忽略不计。虽然在BISN上也可以观察到类似的结果，但其他统计方法通常更倾向于一种时间段而不是另一种时间段，从而使性能不那么稳健。

为了更好地说明关于一天中时间和一周中时间的模型性能，图3给出了DeepTTDE的KL发散度量和三种关于时间性能最好的基线方法。该图还表明，拟议的DeepTTDE在所有研究时间段的表现都优于基线。虽然并不明显，但所有TTDE方法都显示出一周内每天的周期性模式，这符合道路连接线的拥堵状况通常也是周期性的基本事实。对原始结果的更深入的研究表明，与先前【4】给出的结论相似，即周日通常具有图3中所有四种方法的最大估计误差。

与此同时，我们没有在拥堵时间观察到不寻常的KL发散峰值。这种差异可能是由于本工作和【4】中使用的数据集的不同特征造成的。图4显示了在拥堵和自由流动时间段内任意道路连接的经验和估计的累积分布函数(CDF)。可以观察到，DeepTTDE的CDF曲线通常是最接近经验CDF的曲线。

此外，表1中提出和比较的基线方法主要是为TTDE设计的，而DeepTTDE则采用基于图学习的概率估计技术来处理这一问题。我们还将所提出的方法与现有的最先进的**概率深度学习**模型和基于图学习的初步分布估计器进行了比较，以证明DeepTTDE的有效性。特别是，以下具有微小非算法变化的额外基线包括在表2中总结的比较中：
- **深度生成旅行时间(GTT)** [32]采用三层深度生成模型来学习旅行路线的旅行时间分布。为了公平比较，我们认为每条路线都包括一条道路连接线，目的是估计其旅行时间分布。
- **随机和张量化和积网络(RAT-SPN)** [53]通过为网络生成非专门的随机结构，使用和积网络进行深度学习，并使用深度学习优化器训练网络的张量化视图。
- **GCN-Gauss**使用三个图卷积层的堆栈【18】来估计道路旅行时间分布的平均值和方差，将它们视为高斯。
- **GCN-Logn**与GCN-高斯相似，对数正态分布为先验。

从比较中可以清楚地看出，没有一种非TTDE概率预测方法的性能与DeepTTDE相当或优于DeepTTDE，这表明有必要开发量身定制的TTDE方法。尽管与其他基线相比，DeepGTT可以产生相当稳定的估计，但结果的准确性比DeepTTDE和性能更好的基于贝叶斯推理的BISN都差。这一发现可以归因于这样一个事实，即DeepGTT最初是为路线估计而设计的，而不是道路链路估计而设计的，在这两个问题可能具有明显不同的性质。RAT-SPN也面临着同样的挑战，使其低于表1中的基线。最后，使用高斯或对数正态先验的图学习直接估计分布参数似乎与地面真值数据分布不一致，而DeepTTDE的后验估计在这种特定的旅行时间估计方案中相对更内在。

由于旅行时间估计是智能运输系统的实时服务，计算时间对于确定TTDE方法是否可以在线应用至关重要。DeepTTDE的离线训练和在线推理都需要密集的代数计算。在案例研究中采用的计算平台下，一次完整的DeepTTDE训练大约需要26小时，需要巨大的540 000个训练和270 000个验证集。考虑到重要的运输网络拓扑或交通模式变化通常不常见，可以在足够短的时间内使用新数据重新训练DeepTTDE。此外，训练良好的DeepTTDE生成512个旅行时间图用于构建旅行时间分布所需的时间不到3秒，与15分钟的时间段长度相比，这是个微不足道的问题。因此，我们可以得出结论，在在线TTDE服务中可以采用DeepTTDE。请注意，模型训练时间在很大程度上取决于优化器参数。在本工作中，我们使用了Adam的默认配置，通过更好的参数设置，训练效率的提高是合理的。

## 4.3 GPS轨迹稀疏性
在之前的案例研究中，我们在离线训练和在线推理中设置$$β = 30\\%$$。人们可能会注意到，虽然可以使用过去一段时间的30%可用数据创建旅行时间地图，但实时GPS轨迹可能并不丰富，以至于30%的道路连接都被覆盖。在本测试中，我们研究了GPS轨迹稀疏性对DeepTTDE性能的影响。具体来说，采用$$β = 30\\%$$的训练后的DeepTTDE作为估计器。我们模拟了只有1%、2%、5%、10%或20%的道路连接数据可用的实际场景。这些配置可以通过使用第3.2节中相同的旅行时间建模方法并在上述覆盖百分比年龄停止轨迹包含过程来实现。作为参考，还模拟了无实时轨迹情况（$$β=0\\%$$），其中采用Hist-1D而不是DeepTTDE作为基线方法。

图5描述了考虑到各种GPS轨迹稀疏性的DeepTTDE的KL发散，其中每周KL发散在每个小时内平均，以便更好地说明。还观察到，可用轨迹的数量对模型训练和推理时间没有显著影响。模拟结果符合这样的直觉，即更多可用的实时数据通常会导致更好的旅行时间分布估计。当$$β$$小于10%时，增加$$β$$显著降低了平均KL发散。此外，在数据很少的情况下，DeepTTDE的性能不那么稳定。例如，自由流的非高峰性能明显低于拥塞时间段的性能。这是因为拥挤的时间段通常提供更多的GPS轨迹，在固定的β百分比下，提供更多的数据可用。在周线图中也可以清楚地识别出这种模式，其中1% GPS稀疏性的最坏情况性能接近无数据情况，因为最低可用轨迹不足以驱动DeepTTDE进行正确的估计。然而，当提供足够的轨迹（β ≥ 10%）时，上述问题都不存在。考虑到目前最先进的TTDE方法需要大约63% [8]至70% [4]的道路连接覆盖，DeepTTDE能够应用于实时轨迹少得多的场景。

## 4.4 消融试验
在本工作中，我们设计了三个TTDE模块来构建DeepTTDE。虽然第一个地图匹配和旅行时间建模模块实现了旅行时间估计的标准数据预处理，并且是必不可少的，但贝叶斯图自动编码器的体系结构和对抗训练模型的包含是基于对T的直观见解TDE。在本小节中，我们进行了消融测试，以验证其在拟定的DeepTTDE中的有效性。特别是，我们有兴趣研究图卷积和对抗训练对整体性能的贡献。因此，构建了以下四个变体的DeepTTDE：
- **DeepTTDE-AEGC**：贝叶斯图自动编码器中的所有图卷积操作都被全连接神经元取代，即，（1）替换为$$y=\sigma(\omega  x+b)$$，其中$$b$$是可训练的偏置参数。
- **DeepTTDE-ATGC**：对抗训练模型中的所有图卷积操作都被全连接神经元取代。最后一个和-乙状结肠转换被另一层由乙状结肠激活的一个完全连接的神经元所取代。
- **DeepTTDE-AT**：从DeepTTDE中删除对抗训练模型。训练目标成为（5）中定义的KL发散。
- **DeepTTDE-GC-AT**：模型中的所有图卷积操作都被全连接的神经元取代。此外，对抗性训练模型也被删除。

所有DeepTTDE变体都使用第4.1节中介绍的相同数据集和配置进行训练。

表3总结了具有最佳性能基线（即BISN）KL发散和海林格距离的DeepTTDE变体的模拟结果，供参考。此外，考虑到DeepTTDE所需的时间作为基值，给出了DeepTTDE变体的相对训练时间。比较表明了在DeepTTDE中进行图卷积和对抗训练的必要性，其中采用这两种技术都可以提供显著的性能指标改进。通过比较DeepTTDE与DeepTTDE- AEGC和DeepTTDE-AT，可以直接得出这一结论，其中通过去除这两种技术，分别观察到约36%和45%的平均KL发散降解。此外，图卷积的引入可以通过减轻模型由于已纳入模型的拓扑而从训练数据中提取图形信息的负担来实现模型的收敛。尽管删除对抗模型的训练时间降低了11%，但估计精度也因减少而受到影响。因此，对抗模型在预测和时间性能方面都是至关重要的。最后，BISN可以估计比这两种变体更好的旅行时间分布，使这两种技术在DeepTTDE中至关重要。

## 4.5 超参数检验
在第3节中，我们提出了两个在DeepTTDE中的神经网络，即贝叶斯图自动编码器和对抗训练模型。在设计神经网络时，为了获得令人满意的模型性能，层和神经元的最佳数量是多少是一个需要回答的常见问题。虽然没有广义的理论分析来指导这些超参数的选择，但试错方法被广泛采用来确定神经网络体系结构。在本小节中，我们根据表4中记录的超参数配置构建DeepTTDE变体，并检查其TTDE性能作为超参数测试。在本表中，"贝叶斯图自动编码器”列下的值表示DeepTTDE分布估计器中图卷积层的数量及其各自的神经元数量（节点特征），“对抗模型”下的值描述了对抗训练模型中的值。为便于讨论，每个超参数配置都被称为“标签”列下的标签。

图6显示了超参数配置的性能比较。在此图中，训练时间以与DeepTTDE的相对值表示。通过比较，我们可以得出一系列结论。首先，通过删除层或神经元来降低模型容量通常会损害模型性能。这可以通过将DeepTTDE与模型A、B和E进行比较来得出，模型A、B和E分别减少了贝叶斯图自动编码器、对抗模型和两者。该结论符合广泛公认的深度学习原则，即神经网络中足够多的层和神经元可以提高其表达能力，从而利用更多的潜在数据特征进行推理。尽管如此，当模型容量足以完成指定任务时，这种改进的效用很小，并且进一步的扩展导致训练时间急剧增加，作为扩展网络参数搜索空间的副作用。这反映在比较中，模型C和F使用更多的训练时间来实现比原始DeepTTDE相当的性能。

除了前面的架构测试，影响模型性能的另一个关键超参数是近似贝叶斯推理中的先验分布所需的样本数，即，$$K$$.我们还对$$K\in\\{8,16,32,64\\}$$的模拟设置进行了离线测试，观察到当$$K$$降低时，模型估计精度迅速下降。例如，$$K = 16$$的KL发散高达$$1.81 ± 0.38$$，几乎是默认$$K = 32$$的两倍。这是由（8）中定义的损失计算造成的，该计算部分基于KL发散计算。较小的K值使生成的离散分布具有高度的波动性和随机性，这不能类似于后验分布，并使损失和随后的反向传播梯度恶化。另一方面，将$$K$$增加到64并不意味着性能的提高，而是导致训练时间的延长。由于$$K$$的每个参数样本都需要通过神经网络进行一次正向传递，因此该超参数存在一个饱和点，在那里引入更多的样本不能进一步改善损失质量。我们认为32是$$K$$的一个很好的候选者，并在所有案例研究中采用这个值。

## 4.6 DeepTTDE通用性
在以前的所有案例研究中，都采用KDD CUP 2020数据集作为测试数据，这可能并不表明DeepTTDE在其他数据集上的通用性。在本节中，我们进一步采用SIGSPATIAL 2021 GISCUP数据3，作为是否可以在其他城市和数据集采用拟议模型的指示。具体来说，该数据集包括2020年8月中国深圳市约900万条轨迹，每一条轨迹都包括所有穿越道路连接的确切个人旅行时间。在同一时间段内，包括一个或多个链路的每条道路的单个旅行时间值被聚合，以制定地面真实旅行时间分布，该分布进一步用于根据第3.2节构建基本旅行时间图。所有模拟配置与第4.1节相同，比较DeepTTDE与BISN和DeepGTT的模拟结果总结于表5中。结果表明，DeepTTDE具有应用于其他城市和数据集的通用性，同时保持了与贝叶斯推理和深度学习技术支持的最佳基线相比的优势。

## 5. 结论
在本工作中，我们提出了一种新的基于贝叶斯和几何深度学习技术的旅行时间分布估计方法。该方法名为DeepTTDE，利用历史车辆GPS轨迹来模拟全市道路链路旅行时间分布。特别是，首先对历史数据进行预处理，以构建过去的旅行时间地图，每个地图都代表所调查的运输网络的瞬时旅行时间状态。随后，利用一种新的贝叶斯图自动编码器神经网络从历史数据中学习，探索数据不确定性，以估计旅行时间分布。最后，结合一个辅助神经网络来稳定DeepTTDE的训练过程。拟议的DeepTTDE是使用深度学习技术估计旅行时间分布的开创性工作之一。它解决了TTDE的几个关键挑战，即数据不确定性和网络拓扑学习，以及概率分布生成。

为了评估DeepTTDE的性能，我们对大规模真实世界车辆轨迹数据集进行了一系列全面的案例研究。与最先进的基线的比较表明了DeepTTDE的出色性能，它实现了约10%的KL发散减少，实时数据要求要低得多。此外，我们还进行了数据稀疏性测试，以揭示DeepTTDE对实时GPS轨迹可用性的敏感性，并进行了消融测试，以研究DeepTTDE构成组件的必要性。最后，超参数测试提出了确定最佳神经网络结构的准则。

今后的工作可分为三个部分。首先，可以扩展所提出的方法，以解决广泛的数据驱动的智能交通系统问题，例如公共汽车到达时间估计和车辆轨迹预测。DeepTTDE的优点也可以解决这些问题的挑战。其次，现有的TTDE非深度学习方法可能有助于设计基于集合学习的混合估计器，该估计器可以预期继承父级双方的好处。交通网络现有的非直向图松弛也可以被有向图卷积所取代，以获得更好的性能。最后，未来的研究可能会发现DeepTTDE构建块的优越替代方案，如预处理，这将有助于广泛的交通大数据分析应用。
