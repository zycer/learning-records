# 摘要
路段行程时间估计在智能交通运营管理中起着至关重要的作用。由于交通的不稳定带来的不确定性，旅行时间估计用概率分布比确定性模型更好地描述。现有的旅行时间分布估计方法大多基于预定义的概率分布。其他方法虽然放松了约束，但不能利用拓扑信息，而且数据效率低。本文提出了一种新的基于贝叶斯和几何深度学习的方法，用于基于车辆GPS轨迹估计城市交通网络中道路链路的行程时间分布。特别地，首先对历史轨迹或实时轨迹进行预处理，构建部分走时图，并将其输入到定制的贝叶斯图自动编码器中，重建多个完整的走时图。此外，我们还采用了一个辅助神经网络来促进所提方法的参数训练，遵循对抗性训练的原则。为了评价所提出的方法，我们在一系列综合案例研究中使用了一个真实世界的车辆轨迹数据集。实验结果表明，所提出的方法优于目前最优的基线，约10%的Kullback-Leibler散度减少。
# 1. 引言
智能交通系统(ITS)是智能城市的重要组成部分[1]。智能交通作为现代经济中的基础性和战略性产业，以缓解交通拥堵、减少化石燃料消耗、提高运输效率为目标，引起了业界和研究界的广泛关注[2]、[3]。在ITS中，行程时间估计在支持交通监控和车辆路径选择等高级ITS服务方面起着至关重要的作用[4]。更好的估计会改善这些服务的性能，进而导致交通用户的更好体验，包括但不限于车辆和通勤者[5]-[7]。

现有的工业解决方案和研究工作大多是基于历史数据准确地提供交通网络中道路链路的行程时间[8]。然而，准确的路段行程时间受到许多难以记录的因素的影响，如车辆状况和驾驶方式[9]。结果，这些不确定性可能阻碍这些去终止旅行时间估计器产生可靠的估计[4]，[8]。针对这一问题，学术界对所谓的行程时间分布估计(TTDE)的研究日益关注，它假定路段行程时间是由交通的异质性和动态性驱动的时变随机变量[10]、[11]。Pioneer的TTDE工作通常假设旅行时间服从高斯或对数正态分布，并开发了经验结果来讨论它们各自的适用性[12]，[13]。然而，这些参数模型虽然易于理论分析，但不能提供足够的表达来表示旅行时间动力学[9]，[14]。这种关注导致了目前在没有高斯假设的情况下对TTDE的最先进的研究。

一般说来，在没有预先假设的情况下，有两种主流的旅行时间分布方法。最近，Prokhorchuk等人。文[4]提出用高斯copula图形lasso模型将旅行时间的非高斯特性转化为高斯特性。其主要原理是利用copula模型中的协方差矩阵来挖掘相邻路段之间行程时间的统计相关性。由于它的参数性质，所提出的方法可以利用低分辨率和稀疏的GPS轨迹估计时间分布，而不依赖于以前常见的假设，如高斯性和链路无关性。随后，段等人。更进一步，设计了一个基于核密度估计的TTDE模型[8]。采用这种非参数概率密度估计方法，可以很好地捕捉随道路条件变化的时变行程时间动力学。

然而，在TTDE问题上存在研究空白。现有的TTDE方法主要使用稀疏的车辆轨迹[4]或有限的交通检测器[8]来估计分布。一方面，这些方法可以应用到实际的交通网络中，在低数量和/或低质量的交通数据支持下，扩大了其适用性。另一方面，当处理大量的组织车辆痕迹时，要么必须采用数据下采样[4]，要么可能会经历很高的计算负担[8]，这是广泛预期的，也是当代众包技术非常合理的。因此，就产生了数据利用不足的问题。目前已有相关的路线行程时间预测方法，旨在提供城市区域内两个地点之间任意路线的时间估计。然而，这些方法都不能满足TTDE的要求，因为后者更好地用于实时生成最优路线，而前者更多地用于行程分析和离线路线推断[15]。研究差距倡导学术界和工业界为TTDE设计新的解决方案。

数据高效的TTDE方法的前景使深度学习成为一个引人注目的解决方案，它利用多层感知器从原始数据中挖掘潜在的特征[16]。为了弥补这一研究空白，本文基于深度学习技术的最新发展，提出了一种新的城市域TTDE方法。我们特别考虑了存在于原始的、历史的和实时的车辆GPS轨迹中的不确定性，并使用贝叶斯深度学习[17]的原理来从中学习。此外，我们采用图卷积概念[18]进行非欧几里得空间特征提取，它比基于标准张量的数据分析[7]更好地描述了交通网络。该模型是利用数据挖掘和机器学习研究中的深度神经网络构建块建立的，为TTDE提供了一种新的解决方案，并为未来TTDE模型的发展提供了见解。这项工作的主要努力概述如下：
● 提出了一种基于深度学习技术的TTDE方法。采用贝叶斯和几何深度学习的设计原理来构造新的深度神经网络。
● 为了提高该方法的训练性能，我们采用了一种对抗性训练方法，并设计了该方法的训练方案和在线推理方案。
● 我们在一个具有十亿多个GPS记录的真实世界数据集上验证了所提方法的有效性。实证结果证明了该方法的重要性和敏感性。

据我们所知，这是利用深度学习估计道路路段行程时间分布的开创性工作之一。该方法不仅适用于TTDE，而且可以进一步适用于智能交通系统中的各种概率估计问题。

本文的其余部分组织如下。第2节简要概述了相关工作，并对TTDE问题进行了阐述。第三节详细介绍了基于深度学习的TTDE方法，并对其训练和推理进行了详细的介绍。第4节介绍了一个真实世界数据集的案例研究，以证明该方法的有效性。最后，在第五节对本文工作进行了总结。
# 2. 初步工作
## 2.1 相关工作
旅行时间估计是文献[4]中研究较多的一个研究课题，是时空数据挖掘[19]的一个应用。相关研究一般可分为两大类，即确定性行程时间估计，其目的是估计道路链路的平均行程时间，而TTDE则提供了行程时间的估计概率分布。随着big 2数据时代的出现，这两个问题现在都明显依赖于历史旅行时间数据的可用性[20]。提出了多种基于数据挖掘的方法来开发均值估计，包括但不限于线性回归[21]、支持向量回归[22]、人工神经网络[23]、隐马尔可夫模型[24]等。我们请读者参阅[4]、[7]以获得确定性旅行时间估计文献的详细概述。

随着确定性估计问题的出现，TTDE在过去几年中受到了越来越多的关注[8]。在高斯或对数正常旅行时间的假设下进行了一系列研究。文献[12]和[13]分析了高斯分布和对数正态分布在交通流条件和空间相关性下的旅行时间建模中的适用性。参考文献[25]进一步研究了替代概率分布作为基本参数模型。文献[26]使用高斯混合模型推导了旅行时间。文献[4]，[27]，[28]分别将高斯copula与图形套索、贝叶斯推断和截面溢出分析相结合，用于TTDE。参考文献[29]采用移动平均方法来估计威慑旅行时间，并采用分布估计算法来提供先前估计的置信区间。另一方面，放宽高斯假设的尝试导致了基于广泛学习技术的TTDE方法。例如，文献[30]设计了一种基于马尔可夫链的启发式算法来计算主干道连接的行程时间分布。文献[31]提出了一种基于始发目的地对的Bayesian网络的TTDE算法，并利用期望最大化算法解决路径不确定性问题。参考文献[20]提出了一种基于深度学习的生成对抗网络，考虑出行信息最大化来估计短途和长途出行的分布。文献[32]提出了一个深度生成模型来估计包含多个道路连接的路线的行程时间分布，该模型比旅行前规划更适合于旅行后分析和路线恢复[15]。文献[33]采用了一种编码器-解码器深度神经网络，利用道路起伏、交通周期和路线轨迹的嵌入来估计行程时间。该模型的目标是提供确定性的旅行时间估计路线比道路连接，这仍然不是一个确切的匹配TTDE。

综上所述，人们提出了许多方法来正确估计旅行时间分布。然而，较少的研究集中于从数据不确定性中建模和学习，这是重要的，包括在此背景下的认知（系统）和自适应（mea-surement）的不确定性。此外，交通网络所调节的空间数据相关性没有被考虑在内，从而可能导致性能下降。为了解决这些问题，本文提出了一种新的基于深度学习的TTDE方法。
## 2.2 行程时间分布估计
利用稀疏实时GPS数据估计城市交通网络中道路链路的行程时间分布。将交通网络建模为一个有向图,其中V是路段（路段）的集合，E表示路段在V中的连通性，即：如果车辆可以从vi∈V直接穿越到vj∈V,则为(vi,vj)∈E。1给出了这种图表示的一个说明性例子，它不同于通常的道路网络中交叉口由图节点表示的图表示，在利用链接相关性时更具有表现力[34]。TTDE的目标是在给定普遍存在和稀疏的实时GPS轨迹的情况下，获得所有链路v∈v在时隙t长度为θ时的行程时间分布Prv，t(t)。路径行程时间分布可以通过累加构成链路的行程时间分布得到[4]。

TTDE的主要挑战是三重的，每一个都引起了数据挖掘领域的研究兴趣，但没有得到充分的集体解决，尤其是TTDE。首先，GPS轨迹中的认知和任意不确定性使得任何发现潜在旅程时间干扰的数据挖掘策略都具有挑战性。一般的数据驱动方法可能会受到干扰，取而代之的是学习噪声模式，从而产生较差的估计。开发一个量身定制的估计器来充分利用存在不确定性的大量历史数据是一项具有挑战性的任务。其次，连接链路的行程时间变化是高度相关的，因此估计者需要利用链路的行程时间如何依赖于其他[4]，[7]。在交通网络中，这种相关性主要由邻接矩阵捕获。由于计算EF-FORT致力于探索结构或空间数据之间的关系，因此不使用这种拓扑信息可能会导致性能下降。第三，TTDE将旅行时间视为随机变量，并产生它们的估计，这与研究得很好的确定性旅行时间估计不同，后者发展了定点估计[8]。如何推断出准确可靠的概率分布仍然是数据挖掘和表示学习界的一个悬而未决的问题。事实上，没有合作应对这些挑战的解决办法，早先在其他问题上的努力也不能轻易地转移到TTDE上。考虑到这些挑战，我们利用多个构建块和深度学习的设计概念为TTDE提供了一个解决方案。

# 3. 方法论
为了克服以前的挑战，在本工作中，我们提出了一个新的解决方案，用于估计道路连接的全市旅行时间分布，名为DeepTTDE。该解决方案的灵感来自贝叶斯深度学习、图卷积和对抗生成模型的最新研究和进展。它试图将两者的优点结合起来，以应对TTDE以前的所有挑战。在本节中，我们首先概述了拟议的DeepTTDE，然后详细说明了其组成组件。最后，我们讨论了独特的DeepTTDE训练和推理方案。
## 3.1 概述
发送了拟议的DeepTTDE的总体框架。三个主要模块合作导出旅行时间分布，即地图匹配和旅行时间建模、旅行时间分布估计器和对抗训练模型。给定GPS轨迹的集合，我们首先将原始地理坐标转换为图G上的路径，通过该路径计算每个轨迹的链路旅行时间是微不足道的。随后，利用轨迹链路旅行时间数据，通过独特的旅行时间建模算法构建多个旅行时间图。每个旅行时间地图都是来自整个城市潜在旅行时间分布的单个样本，我们采用贝叶斯图自动编码器来类似这些样本的分布。最后，引入了一个辅助对抗训练神经网络，以辅助前一个图自动编码器的参数训练，从而提高估计分布的准确性。

在深入探讨组成DeepTTDE的每个模块的细节之前，我们首先解释所使用技术背后的原理，特别是贝叶斯图自动编码器结构。所有模块都是围绕旅行时间分布估计器的要求设计的。虽然基于深度学习的技术在解决大量问题方面表现出了最先进的性能，但它们通常受到一系列限制，包括在不确定性学习方面的薄弱、非欧几里德表示、并且很容易被对抗样本[17], [35]破坏。人们可能会发现，第2.2节中引入的TTDE的主要挑战与一般深度学习技术的上述限制明显重叠。

DeepTTDE通过采用贝叶斯深度学习、几何深度学习和对抗性机器学习的设计原则来解决挑战和局限性。贝叶斯深度学习能够解释认识不确定性和自由不确定性，这两种不确定性在交通数据中都很普遍[17], [36]。特别是，该模型在每个神经网络参数上放置先验分布，然后可以通过贝叶斯推理近似后验分布。因此，模型不确定性通过参数分布的形状捕获，输入数据中的统计不确定性反映在后验中。其次，几何深度学习使DeepTTDE能够在计算过程中有效地表示图结构，减轻了试图从未明确显示道路连通性的交通数据中提取拓扑信息的深度学习模型所带来的巨大计算负担[35]。第三，贝叶斯模型本质上是概率性的，它使一般深度学习模型能够表示不确定性和推断分布，这完美地满足了TTDE关于估计概率分布的要求[36]。利用条件概率作为神经网络参数，贝叶斯模型通过采样这些参数来估计分布，而不是添加输出噪声或设置多个输入场景。

## 3.2 地图匹配与行驶时间建模
在DeepTTDE中，地图匹配和旅行时间建模的主要目标是为后续旅行时间分布估计器提取潜在信息提供足够的行驶时间地图。顾名思义，它有两个主要步骤。地图匹配的目的是将GPS轨迹投影到道路网上。由于这个问题已经被广泛研究[37]–[39]，我们采用了一种基于交互式投票的算法实现【37】来在DeepTTDE中执行地图匹配。这也是相关研究中广泛采用的方式，一些例子见[4], [7]。

在开发地图匹配路径后，行驶时间建模尝试计算路径中每个链路的行驶时间。这可以通过假设车辆在连续轨迹点之间遵循恒定速度【4】来实现。具体来说，对于具有$$k$$个GPS位置的任意轨迹，让第一个轨迹点的映射位置为$$p_1$$，最后一个轨迹点的映射位置为$$p_k$$。如果连续位置$$p_i$$和$$p_{i+1}$$都在同一链路上，则它们之间的采样时间差，用$$\Delta_{i \rightarrow i+1}$$表示，将累积到相应链路的旅行时间。否则，“从”链接的行程时间增加$$\frac{d_{i \rightarrow i+1}}{d_{i \rightarrow i+1}+d_{i+1 \rightarrow i}}\Delta_{i \rightarrow i+1}$$，剩余时间增加到“到”链接的行程时间，其中$$d_{i→i+1}$$和$$d_{i+1→i}$$是从$$p_i$$和$$p_{i+1}$$到两个链接的交叉点的距离。

因此，可以基于计算的链路旅行时间构建多个旅行时间图。对于每个旅行时间图，我们首先根据图1创建一个有向运输图，其中每个节点嵌入了一个道路连接。每个节点$$v_i$$被初始化为一个元组$$X_i=(t_i,c_i,f_i^1,f_i^2,...)$$，其中$$t_i$$是$$v_i$$的瞬时旅行时间，$$c_i$$是嵌入1的采样时间，和$$f_i^j$$是相应道路链路的静态特征，例如限速、车道计数、链路长度等。然后，我们随机选择长度为15分钟的时间间隔，并聚合该周期内的所有轨迹。轨迹被排列并迭代地选择以包括在旅行时间地图中：如果其构成的链接都没有被其他链接覆盖，则包括一个轨迹。如果包括轨迹，则其所有构成链路的$$t_i$$和$$c_i$$值将用先前计算的相应旅行时间和采样时间更新。此过程重复，直到覆盖所有链接的预定义部分（案例研究中70%，以避免过度计算负担，值取自【4】），或检查所有轨迹。生成的旅行时间图是地面真相全市旅行时间分布的真实样本。值得注意的是，地图匹配和旅行时间建模预处理是基于轨迹的交通大数据分析的典型。我们打开了探索传统方法的替代方案的可能性，作为未来可能的研究方向。

## 3.3 旅行时间分布估计器
对于从原始GPS轨迹构建地面真实旅行时间样本的上一个模块，后续旅行时间分布估计器的目的是学习相对于时间的旅行时间分布动态。在DeepTTDE中，由于第3.1节中介绍的优点，提出了一个贝叶斯图自动编码器来实现这一目标。为了描述所提出的深度学习模型的体系结构，我们首先简要介绍了它对非欧几里德数据处理的基本操作，即图卷积。

图卷积是图卷积网络【18】中最广泛认识的一种数值运算，它聚合了图中相邻节点的节点信息。当用于神经网络时，它的目的是从原始数据中提取局部图形特征。该操作继承了处理欧几里德空间数据的规范卷积神经网络（CNN）的卷积滤波器概念。这样的过滤器通过定义参数一致接受字段，对源数据执行邻域混合，从而导致本地信息共享[16]。虽然CNN中的接受字段通常是矩形的，但图卷积使用图连接性作为邻域混合的过滤器，以应对输入图数据的非欧几里德结构。给定图的每个节点上具有自环的增强邻接矩阵，用$$\dot{A}$$表示，图卷积采用特征$$x$$来计算输出$$y$$，如下【18】：
$$y=\sigma(\dot{D}^{-\frac{1}{2}}\dot{A}\dot{D}^{-\frac{1}{2}}xw)$$
其中，$$\dot{D}=diag(\dot{A1})$$是对角度矩阵，$$w$$是要通过反向传播学习的该图卷积的权重参数，函数σ是在本工作中一个非线性哈函数-$$ReLU(x)=x^+=max(0,x)$$。
