5.2.2
在原型系统的架构设计中，数据处理模块是一个关键部分，它负责获取并处理原始数据，为后续的地图匹配和模型训练与预测提供所需的数据支持。数据处理模块主要包括数据获取与数据预处理两部分。
图
图
图
数据获取这一部分的任务是调用Overpass API下载前端用户所选区域的OSM文件，图【~】中展示了用户在前台选取区域并下载对应数据操作，当用户点击下载数据按钮时，系统会获取地图范围数据请求OverPass API接口下载对应区域的OSM文件，如图【】为南京市建邺区部分OSM文件示例。在获取OSM文件后系统会根据区域位置请求对应区域的开放交通数据API接口，筛选出对应区域的GPS历史轨迹数据，这些数据作为原始输入，为后续的数据预处理和分析提供基础。
图
数据预处理：在这一部分，我们对获取到的GPS轨迹数据和OSM文件进行处理，以便更好地应用于地图匹配和模型训练与预测。数据预处理包括以下几个步骤：
a)	GPS轨迹去噪：对于车辆停止时产生的轨迹数据以及两个连续轨迹点位置相差过大的点进行删除，从而减少噪声对模型训练与预测的影响。
b) OSM文件解析：读取OSM文件中的node标签与way标签，将OSM数据解析成路网图结构，并将解析后的路网图进行简化，即对于同一路口的多个节点合并为同一个节点，如图【】为处理后的道路数据，其中每一条数据作为路网图结构中的一条边，每一条道路有name、hightway、length以及maxspeed等多个特征，图【】为处理后的到路口数据，每一条数据作为路网结构中的一个节点，由于节点只表示道路的连接性，所以节点除了位置信息无其他特征。这一步骤为后续的地图匹配和模型训练与预测提供了基本的地理信息。
c) 图反转：将解析出的路网图进行反转，即将原来的道路表示为边，路口表示为节点的图结构反转为道路表示为节点，道路之间的连接关系表示为边。这样能够更好地适应基于贝叶斯图卷积神经网络的模型学习与特征表示。如图【】为反转后的边数据。
图
图
图
通过以上数据处理模块的设计与实现，我们为原型系统提供了清洗后的高质量数据，为后续的地图匹配和基于贝叶斯图卷积神经网络的城市道路行驶时间预测模型训练与预测奠定了基础。这一模块的有效性对整个原型系统的性能和准确性至关重要。

5.2.3
在原型系统的架构设计中，地图匹配模块是另一个核心组件，负责将经过数据处理模块处理后的GPS轨迹数据与路网图进行匹配，并将计算出的每条道路历史行驶速度持久化为道路行驶时间预测提供基础数据，本模块主要调用论文前面提出的基于Web墨卡托的交互式地图匹配方法（MIVMM）来实现地图匹配。
基于Web墨卡托的交互式地图匹配方法首先采用卡尔曼滤波法对GPS数据中偏差过大的数据点进行纠正。接着，根据GPS采样点之间的相互影响，分别采用空间分析、时间分析和道路分析来度量连续候选点之间的关系。通过引入这三种约束条件，进一步过滤掉数据中的噪声，提升了算法的效率。同时，该方法使用墨卡托投影算法以及球面距离的计算，提高了匹配的准确度。此外，MIVMM算法采用候选边缘投票，相较于候选点投票，该投票方法对连续点之间的关系更加敏感，从而进一步提高了投票的准确率。
图
由于地图匹配是一个耗时任务，因此在我们的原型系统中将地图匹配任务提交至Celery异步处理，图【】为用户选取数据处理模块处理后的数据并点击对应的地图匹配按钮，此时系统会申请一个进程异步处理该任务，任务会加入任务列表中，如图【】为任务列表界面，选择对应任务并点击查看详情，会进入地图匹配详情界面，如图【】，该界面通过websocket技术与后端连接，后端不断将匹配好的数据发送给前台页面，以供前台页面实时展示匹配进度。
地图匹配模块是原型系统的关键组成部分，它利用基于Web墨卡托的交互式地图匹配方法对处理过的GPS轨迹数据和路网图进行匹配，为后续的模型训练与预测提供了基础。地图匹配模块的实现能够确保整个原型系统在各种路网结构下具有较高的匹配准确性和效率。

5.2.4
在原型系统的架构设计中，行驶时间预测模型的训练与预测模块是最关键部分，主要负责实现论文第四章提出的基于贝叶斯深度图学习的城市道路行驶时间预测模型。该模型首先自定义了贝叶斯图卷积层，为整个模型加入了不确定性，然后提出了贝叶斯时空图变分自编码器模型。为了加速模型的训练过程，我们引入了对抗网络的生成部分，通过判别器与生成器的相互竞争来加快模型的收敛。在原型系统中，为了使竞争更加公平，我们采用了许多平衡方法，如梯度惩罚和梯度裁剪等。这些方法有助于提高模型的训练效率，同时确保模型具有良好的性能。
行驶时间预测模型的训练与预测模块具有以下功能：
使用基于贝叶斯深度图学习的城市道路行驶时间预测模型对行驶时间进行预测。
自定义贝叶斯图卷积层以实现更高效的图学习方法。
使用贝叶斯时空图变分自编码器模型进行特征提取和表示学习。
引入对抗网络的生成部分以加速模型训练过程，并采用梯度惩罚、梯度裁剪等平衡手段确保竞争公平。
图
图
图
图
图【】展示了在路网数据页面下发预测任务，图【】与图【】分别为模型训练时生成器与判别器的实时loss数据。在这个页面用户可以及时且详细的查看模型训练的情况，当生成器与判别器的loss收敛时可以手动停止训练。图【】展示了在模型训练完成后，预测下一个时间节点时刻区域中所有道路的行驶时间，横坐标为道路索引，纵坐标为对应道路的行驶时间。通过行驶时间预测模型的训练与预测模块，我们可以根据道路网络和历史行驶数据预测未来特定时间段内的行驶时间。该模块在整个原型系统中起到了关键作用，为用户提供了准确且实用的行驶时间预测结果，有助于实现智能出行和交通管理的优化。
